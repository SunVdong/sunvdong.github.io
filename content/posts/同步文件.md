---
title: '同步文件'
date: '2025-08-05T18:03:34+08:00'
draft: false
author: vdong
categories:
  - 技术
tags:
  - rsync
  - lsyncd
typora-root-url: ..\..\..\static
---

### 安装
```
apt install rsync lsyncd  -y
```

### 配置
```shell
vim /etc/lsyncd/lsyncd.conf.lua
settings {
    logfile    = "/var/log/lsyncd/lsyncd.log",
    statusFile = "/var/log/lsyncd/lsyncd.status",
    nodaemon   = false,
    maxProcesses = 2
}

sync {
    default.rsync,
    source = "/video/",
    target = "/www/backup/",
    rsync = {
        archive = true,
        compress = false,
        verbose = true,
        _extra = {"--omit-dir-times", "--ignore-errors"},
    },
    delete = "no",
}
```

### 启动与开机自启动
```shell
 systemctl start lsyncd

 systemctl enable lsyncd
```


## 定时删除
```shell
# 删除3天前（空目录 + 旧文件）
find /video/ -mindepth 1 -mtime +3 -exec rm -rf {} \;



crontab -e

0 3 * * * /usr/bin/find /video/ -mindepth 1 -mtime +3 -exec rm -rf {} \; > /dev/null 2>&1
```
